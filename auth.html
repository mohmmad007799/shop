<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول / إنشاء حساب</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Tahoma, Arial,sans-serif;}
body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;}

.container{
  background:rgba(255,255,255,.1);
  padding:30px;
  border-radius:20px;
  width:300px;
  backdrop-filter:blur(10px);
  text-align:center;
}

h2{margin-bottom:20px;color:#00ffcc;}

input{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
  outline:none;
}

button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  background:#00ffcc;
  color:#000;
  font-weight:bold;
  transition:.2s;
}

button:hover{background:#00c3ff;}

.toggle{
  margin-top:15px;
  cursor:pointer;
  color:#00c3ff;
  text-decoration:underline;
  font-size:14px;
}
.error{color:#ff4d4d;font-size:13px;margin-top:5px;}
</style>
</head>

<body>
<div class="container" id="authContainer">
  <h2 id="formTitle">تسجيل الدخول</h2>

  <div id="formError" class="error"></div>

  <input type="text" id="username" placeholder="اسم المستخدم" required>
  <input type="email" id="email" placeholder="البريد الإلكتروني" required style="display:none;">
  <input type="password" id="password" placeholder="كلمة المرور" required>

  <button id="submitBtn">تسجيل الدخول</button>
  <div class="toggle" id="toggleForm">ليس لديك حساب؟ إنشاء حساب</div>
</div>

<script>
// ---------- المخزن ----------
const USERS_KEY = "APP_USERS";

// ---------- DOM ----------
const authContainer = document.getElementById("authContainer");
const formTitle = document.getElementById("formTitle");
const toggleForm = document.getElementById("toggleForm");
const submitBtn = document.getElementById("submitBtn");
const formError = document.getElementById("formError");

let isLogin = true;

// ---------- وظائف المخزن ----------
function loadUsers() {
  return JSON.parse(localStorage.getItem(USERS_KEY) || "[]");
}

function saveUsers(users) {
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
}

function addUser(user){
  const users = loadUsers();
  users.push(user);
  saveUsers(users);
}

// ---------- تبديل بين تسجيل الدخول وإنشاء حساب ----------
toggleForm.addEventListener("click", ()=>{
  isLogin = !isLogin;
  formError.textContent = "";
  if(isLogin){
    formTitle.textContent = "تسجيل الدخول";
    submitBtn.textContent = "تسجيل الدخول";
    toggleForm.textContent = "ليس لديك حساب؟ إنشاء حساب";
    document.getElementById("email").style.display = "none";
  } else {
    formTitle.textContent = "إنشاء حساب";
    submitBtn.textContent = "إنشاء حساب";
    toggleForm.textContent = "لديك حساب؟ تسجيل الدخول";
    document.getElementById("email").style.display = "block";
  }
});

// ---------- تحقق من البيانات ----------
submitBtn.addEventListener("click", ()=>{
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const email = document.getElementById("email").value.trim();

  if(!username || !password || (!isLogin && !email)){
    formError.textContent = "الرجاء ملء جميع الحقول";
    return;
  }

  const users = loadUsers();

  if(isLogin){
    const user = users.find(u=>u.username === username && u.password === password);
    if(user){
      localStorage.setItem("CURRENT_USER", JSON.stringify(user));
      formError.textContent = "";
      alert("تم تسجيل الدخول بنجاح!");
      // هنا يمكنك إعادة التوجيه للصفحة الرئيسية
      // window.location.href = "profile.html";
    } else {
      formError.textContent = "اسم المستخدم أو كلمة المرور غير صحيحة";
    }
  } else {
    if(users.find(u=>u.username===username)){
      formError.textContent = "اسم المستخدم موجود مسبقًا";
      return;
    }
    const newUser = {id:Date.now(), username, email, password};
    addUser(newUser);
    localStorage.setItem("CURRENT_USER", JSON.stringify(newUser));
    formError.textContent = "";
    alert("تم إنشاء الحساب بنجاح!");
    // إعادة التوجيه للملف الشخصي
    // window.location.href = "profile.html";
  }
});
</script>

</body>
</html>
