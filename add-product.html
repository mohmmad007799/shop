<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Tahoma, Arial}
body{
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#00ffcc;
  padding-bottom:80px;
}

/* ================= HEADER ================= */
header.top{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:15px 20px;
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(10px);
  position:sticky;
  top:0;
  z-index:1000;
}
header.top h3{margin:0;font-weight:bold;}
header.top img{width:38px;height:38px;border-radius:8px;}

/* ================= CONTAINER ================= */
.container{
  max-width:900px;
  margin:20px auto;
  background:rgba(255,255,255,.18);
  backdrop-filter:blur(15px);
  padding:20px;
  border-radius:22px;
  display:flex;
  gap:20px;
  flex-wrap:wrap;
}

/* ================= FILE DROP ================= */
.file-drop{
  flex:1 1 250px;
  min-width:250px;
  border:2px dashed #00ffcc;
  border-radius:14px;
  padding:25px;
  text-align:center;
  color:#00ffcc;
  cursor:pointer;
  transition:.25s;
}
.file-drop:hover{
  background:rgba(0,255,204,.08);
}
.file-drop.success{
  background:rgba(0,255,204,.12);
  border-color:#00c3ff;
  color:#00c3ff;
}

/* ================= DETAILS ================= */
.details{
  flex:2 1 400px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* ================= INPUTS & TEXTAREAS ================= */
.details input,
.details textarea{
  width:100%;
  padding:11px 14px;
  border-radius:10px;
  border:none;
  outline:none;
  font-size:14px;

  background:#90ffe9;
  color:#404040;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ù†Ø§Øª */
.details input:focus,
.details textarea:focus{
  outline:2px solid #00ffcc;
}

/* textarea Ø­Ø¬Ù…Ù‡Ø§ */
.details textarea{
  resize:none;
  height:80px;
}

/* ================= BUTTON ================= */
button.primary{
  background:linear-gradient(90deg,#00ffcc,#00c3ff);
  color:#000;
  border:none;
  padding:12px;
  border-radius:12px;
  font-size:16px;
  cursor:pointer;
  transition:.25s;
}
button.primary:hover{opacity:.9;}

/* ================= SUCCESS MODAL ================= */
#successModal{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,.6);
  z-index:2000;
}
#successModal .modal-content{
  background:#fff;
  color:#000;
  padding:30px 20px;
  border-radius:20px;
  text-align:center;
  max-width:300px;
  width:90%;
}
#successModal .circle{
  width:60px;
  height:60px;
  background:#00c3ff;
  border-radius:50%;
  margin:0 auto 15px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:30px;
  color:#fff;
}
#successModal button{
  background:#00ffcc;
  color:#000;
  border:none;
  padding:10px 15px;
  border-radius:10px;
  cursor:pointer;
  margin-top:10px;
}

/* ================= BOTTOM BAR ================= */
.bottom-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(10px);
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}
.bottom-bar a{
  color:#fff;
  text-decoration:none;
  opacity:.85;
  font-size:18px;
}

@media(max-width:768px){
  .container{flex-direction:column;}
}
</style>
</head>

<body>

<header class="top">
  <h3>ØªØ·Ø¨ÙŠÙ‚Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h3>
  <img src="https://via.placeholder.com/40">
</header>

<form class="container" id="addForm">

  <!-- ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© -->
  <div class="file-drop" id="backgroundDrop">Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
  <input type="file" id="backgroundInput" accept="image/*" hidden>

  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div class="details">
    <div class="file-drop" id="productDrop">Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬ (ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ù…Ù„Ù) Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
    <input type="file" id="productInput" accept="image/*,video/*,application/*" hidden>

    <input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required maxlength="50">
    <textarea id="pdesc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± (Ø­ØªÙ‰ 50 Ø­Ø±Ù)" maxlength="50"></textarea>
    <textarea id="ptext" placeholder="Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ù†ØªØ¬ (Ø­ØªÙ‰ 120 Ø­Ø±Ù)" maxlength="120"></textarea>
    <input id="pprice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>

    <button class="primary" type="submit">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
  </div>
</form>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ -->
<div id="successModal">
  <div class="modal-content">
    <div class="circle">âœ”</div>
    <p>ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</p>
    <button onclick="closeModal()">ØªØ£ÙƒÙŠØ¯</button>
  </div>
</div>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ -->
<div class="bottom-bar">
  <a href="index.html">ğŸ </a>
  <a href="add-product.html">â•</a>
  <a href="cart.html">ğŸ›’</a>
  <a href="profile.html">ğŸ‘¤</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// ================= Firebase Config =================
const firebaseConfig = {
  apiKey: "AIzaSyCmArZk0HDaTyIYWCvo4qUUs6wtbOug5fs",
  authDomain: "shop-65260.firebaseapp.com",
  projectId: "shop-65260",
  storageBucket: "shop-65260.appspot.com",
  messagingSenderId: "828188332596",
  appId: "1:828188332596:web:9727077b8210a7e63a3061",
  measurementId: "G-560CHRLKRQ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
const auth = getAuth(app);

// ================= Ø¹Ù†Ø§ØµØ± DOM =================
const backgroundDrop = document.getElementById("backgroundDrop");
const backgroundInput = document.getElementById("backgroundInput");
const productDrop = document.getElementById("productDrop");
const productInput = document.getElementById("productInput");
const pname = document.getElementById("pname");
const pdesc = document.getElementById("pdesc");
const ptext = document.getElementById("ptext");
const pprice = document.getElementById("pprice");
const addForm = document.getElementById("addForm");
const successModal = document.getElementById("successModal");

// ================= ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù„ÙØ§Øª =================
function setupFileDrop(drop, input, successText){
  drop.onclick = () => input.click();
  drop.ondragover = e => e.preventDefault();
  drop.ondrop = e => {
    e.preventDefault();
    input.files = e.dataTransfer.files;
    validateFile(drop, input, successText);
  };
  input.onchange = () => validateFile(drop, input, successText);
}

function validateFile(drop, input, successText){
  const file = input.files[0];
  if(!file){
    drop.textContent = drop.id==="backgroundDrop"?"Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±":"Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬ (ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ù…Ù„Ù) Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±";
    drop.classList.remove("success");
    return;
  }
  drop.textContent = successText+" âœ…";
  drop.classList.add("success");
}

setupFileDrop(backgroundDrop, backgroundInput, "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ©");
setupFileDrop(productDrop, productInput, "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù");

// ================= Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ =================
addForm.onsubmit = async e => {
  e.preventDefault();
  if(!pname.value || !pprice.value || !pdesc.value || !ptext.value || !productInput.files[0] || !backgroundInput.files[0]){
    alert("ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆÙ…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬!");
    return;
  }

  try {
    // Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Firebase Storage
    const bgFile = backgroundInput.files[0];
    const prodFile = productInput.files[0];

    const bgRef = ref(storage, `products/backgrounds/${Date.now()}_${bgFile.name}`);
    const prodRef = ref(storage, `products/files/${Date.now()}_${prodFile.name}`);

    await uploadBytes(bgRef, bgFile);
    await uploadBytes(prodRef, prodFile);

    const bgURL = await getDownloadURL(bgRef);
    const prodURL = await getDownloadURL(prodRef);

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Firestore
    await addDoc(collection(db, "products"), {
      name: pname.value,
      desc: pdesc.value + " " + ptext.value,
      price: Number(pprice.value),
      backgroundURL: bgURL,
      fileURL: prodURL,
      owner: auth.currentUser?.uid || "guest",
      createdAt: serverTimestamp()
    });

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    successModal.style.display = "flex";
  } catch (error) {
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬: " + error.message);
  }
};

// Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­
function closeModal(){
  successModal.style.display = "none";
  addForm.reset();
  backgroundDrop.textContent="Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±";
  backgroundDrop.classList.remove("success");
  productDrop.textContent="Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬ (ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ù…Ù„Ù) Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±";
  productDrop.classList.remove("success");
}
</script>

</body>
</html>
